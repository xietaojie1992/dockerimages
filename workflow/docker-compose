version: "3"
services:
  gitlab:
    image: 'gitlab/gitlab-ce:13.3.5-ce.0'
    restart: always
    hostname: 'gitlab'
    container_name: gitlab
    ports:
      - '23000:80'
      - '23001:8443'
      - '23002:22'
    volumes:
      - '/data/gitlab/config:/etc/gitlab'
      - '/data/gitlab/logs:/var/log/gitlab'
      - '/data/gitlab/data:/var/opt/gitlab'
    network_mode: workflow

  jenkins:
    build:
      context: .
      dockerfile: Dockerfile.jenkins
    restart: always
    hostname: 'jenkins'
    container_name: jenkins
    ports:
      - '23100:8080'
      - '23101:50000'
    volumes:
      - '/data/jenkins_home:/var/jenkins_home'
      - '/var/run/docker.sock:/var/run/docker.sock'
    network_mode: workflow

  jira:
    image: atlassian/jira-software:latest
    container_name: jira
    hostname: jira
    restart: always
    ports:
      - 23200:8080
    network_mode: workflow

  confluence:
    image: atlassian/confluence-server:latest
    container_name: confluence
    hostname: confluence
    ports:
      - 23300:8090
    network_mode: workflow

  postgresql:
    image: "postgres:10.9-alpine"
    container_name: postgresql
    hostname: prostgresql
    restart: unless-stopped
    ports:
      - 5432:5432
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-jira}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-jirapassword}
      POSTGRES_DB: ${POSTGRES_DB:-jiradb}
      POSTGRES_ENCODING: ${POSTGRES_ENCODING:-UNICODE}
      POSTGRES_COLLATE: ${POSTGRES_COLLATE:-C}
      POSTGRES_COLLATE_TYPE: ${POSTGRES_COLLATE_TYPE:-C}
    volumes:
    - "/data/postgresql/data:/var/lib/postgresql/data"
    network_mode: workflow

networks:
  default:
    external:
      name: workflow